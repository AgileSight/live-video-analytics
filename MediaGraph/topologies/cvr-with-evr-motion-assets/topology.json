{
    "@apiVersion": "1.0",

    "name": "CVRAndEVROnMotiontoFiles",

    "properties": {
        "description": "Continuous video recording and motion event-based recording to file",
        "parameters": [
            {
                "name": "rtspUserName",
                "type": "String",
                "description": "rtsp source user name.",
                "default": "dummyUserName"
            },
            {
                "name": "rtspPassword",
                "type": "String",
                "description": "rtsp source password.",
                "default": "dummyPassword"
            },
            {
                "name": "rtspUrl",
                "type": "String",
                "description": "rtsp Url"
            },
            {
                "name": "motionSensitivity",
                "type": "String",
                "description": "motion detection sensitivity",
                "default": "medium"
            },
            {
                "name": "hubSinkOutputName",
                "type": "String",
                "description": "hub sink output name",
                "default": "inferenceOutput"
            }
        ],
        "sources": [
            {
                "@type": "#Microsoft.Media.MediaGraphRtspSource",
                "name": "rtspSource",
                "transport": "tcp",
                "endpoint": {
                    "@type": "#Microsoft.Media.MediaGraphClearEndpoint",
                    "url": "${rtspUrl}",
                    "credentials": {
                        "@type": "#Microsoft.Media.MediaGraphUsernamePasswordCredentials",
                        "username": "${rtspUserName}",
                        "password": "${rtspPassword}"
                    }
                }
            }
        ],
        "processors": [
            {
                "@type": "#Microsoft.Media.MediaGraphMotionDetectionProcessor",
                "name": "motionDetection",
                "sensitivity": "medium",
                "inputs": [
                    {
                        "nodeName": "rtspSource"
                    }
                ]
            },
            {
                "@type": "#Microsoft.Media.MediaGraphSignalGateProcessor",
                "name": "signalGateProcessor",
                "inputs": [
                    {
                        "nodeName": "motionDetection"
                    },
                    {
                        "nodeName": "rtspSource"
                    }
                ],
                "activationEvaluationWindow": "PT1S",
                "activationSignalOffset": "PT0S",
                "minimumActivationTime": "PT15S",
                "maximumActivationTime": "PT15S"
            }
        ],
        "sinks": [
          
            {
                "@type": "#Microsoft.Media.MediaGraphFileSink",
                "name": "fileSink",
                "inputs": [
                  {
                    "nodeName": "signalGateProcessor"
                  }
                ],
                "filePathPattern": "/var/media/sampleFilesFromEVR-${System.DateTime}"
            },
            {
                "@type": "#Microsoft.Media.MediaGraphAssetSink",
                "name": "assetSinkCVR",
                "assetNamePattern": "sampleAssetFromCVR-LVAEdge-${System.DateTime}",
                "segmentLength": "PT30S",
                "localMediaCacheMaximumSizeMb": "2048",
                "localMediaCachePath": "/var/lib/azuremediaservices/tmp/",
                "inputs": [
                    {
                        "nodeName": "rtspSource"
                    }
                ]
            },
            {
                "@type": "#Microsoft.Media.MediaGraphIoTHubMessageSink",
                "name": "hubSink",
                "hubOutputName": "inferenceOutput",
                "inputs": [
                    {
                        "nodeName": "motionDetection"
                    }
                ]
            }
        ]
    }
}